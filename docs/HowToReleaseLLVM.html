<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
                      "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>How To Release LLVM To The Public</title>
  <link rel="stylesheet" href="llvm.css" type="text/css">
</head>
<body>

<div class="doc_title">How To Release LLVM To The Public</div>
<p class="doc_warning">NOTE: THIS DOCUMENT IS A WORK IN PROGRESS!</p>
<ol>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#process">Release Process</a></li>
</ol>
<div class="doc_author">
  <p>Written by <a href="mailto:rspencer@x10sys.com">Reid Spencer</a></p>
</div>

<!-- *********************************************************************** -->
<div class="doc_section"><a name="introduction">Introduction</a></div>
<!-- *********************************************************************** -->

<div class="doc_text">
<p>This document collects information about successfully releasing LLVM to the
public. It is the release manager's guide to ensuring that a high quality build
of LLVM is released. Mostly, its just a bunch of reminders of things to do at
release time so we don't inadvertently ship something that is utility 
deficient.</p>
</div>

<!-- *********************************************************************** -->
<div class="doc_section"><a name="process">Release Process</a></div>
<!-- *********************************************************************** -->

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="overview">Process Overview</a></div>
<div class="doc_text">
  <ol>
    <li><a href="#merge">Merge Branches</a></li>
    <li><a href="#settle">Settle LLVM HEAD</a></li>
    <li><a href="#build">Build LLVM</a></li>
    <li><a href="#check">Run 'make check'</a></li>
    <li><a href="#test">Run LLVM Test Suite</a></li>
    <li><a href="#deps">make LibDeps.txt</a></li>
    <li><a href="#tag">cvs tag</a></li>
    <li><a href="#dist">make dist</a></li>
    <li><a href="#release">release</a></li>
  </ol>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="merge">Merge Branches</a></div>
<div class="doc_text">
<p>Merge any work done on branches intended for release into mainline. Work that
is not to be incorporated into the release should not be merged from the branch.
</p>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="settle">Settle CVS HEAD</a></div>
<div class="doc_text">
  <p>Use the nightly test reports, and 'make check' (deja-gnu based tests) to 
  increase the quality of LLVM and ensure that merged branches have not
  destabilized LLVM.</p>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="build">Build LLVM</a></div>
<div class="doc_text">
  <p>Build both debug and release versions of LLVM on all platforms. Ensure
  build is warning and error free on each platform.</p>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="check">Run 'make check'</a></div>
<div class="doc_text">
  <p>Run <tt>make check</tt> and ensure there are no unexpected failures. If
  there are, resolve the failures and go back to <a href="#settle">step 2</a>.
  Ensure that 'make check' passes on all platforms for all targets. If certain
  failures cannot be resolved before release time, determine if marking them
  XFAIL is appropriate. If not, fix the bug and go back. The test suite must
  complete with "0 unexpected failures" for release.
  </p>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="test">LLVM Test Suite</a></div>
<div class="doc_text">
  <p>Run the llvm-test suite and ensure there are no unacceptable failures.
  If there are, resolve the failures and go back to step 2. The test suite
  should be run in Nightly Test mode. All tests must pass. If they do not,
  investigate and go back to settling CVS HEAD.</p>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="deps">Make LibDeps.txt</a></div>
<div class="doc_text">
  <p>Rebuild the <tt>LibDeps.txt</tt> target in <tt>utils/llvm-config</tt>. This
  makes sure that the <tt>llvm-config</tt> utility remains relevant for the
  release, reflecting any changes in the library dependencies.</p>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="tag">CVS Tag And Branch</a></div>
<div class="doc_text">
  <p>Tag and branch the CVS HEAD using the following procedure:</p>
  <ol>
    <li>Request all developers to refrain from committing. Offenders get commit
    rights taken away (temporarily).</li>
    <li>Tag the cvs HEAD with "ROOT_RELEASE_XX" where XX is the major and minor
    release numbers (you can't have . in a cvs tag name). So, for Release 1.2,
    XX=12 and for Release 1.10, XX=110.</li>
    <li>Immediately create a cvs branch based on the ROOT_RELEASE tag. This is
    where the release distribution will be created.</li>
    <li>Advise developers they can work on CVS HEAD again.</li>
    <li>Ensure all subsequent building and fixing is done on this branch.</li>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="dist">Run 'make dist'</a></div>
<div class="doc_text">
  <p>Build the distribution, ensuring it is installable and working. This is a
  two step process. First, use "make dist" to simply build the distribution. Any
  failures need to be corrected (on the branch). Once "make dist" can be
  successful, do "make dist-check". This target will do the same thing as the
  'dist' target but also test that distribution to make sure it works. This
  ensures that needed files are not missing and that the src tarball can be
  successfully unbacked, built, installed, and cleaned. This two-level testing
  needs to be done on each target platform.</p>
</div>

<!-- ======================================================================= -->
<div class="doc_subsection"><a name="release">Release</a></div>
<div class="doc_text">
  <p>Release the distribution tarball to the public. This consists of generating
  several tarballs. The first set, the source distributions, are automatically
  generated by the "make dist" and "make dist-check". There are gzip, bzip2, and
  zip versions of these bundles.</p>
  <p>The second set of tarballs is the binary release. When "make dist-check"
  succeeds, it will have created an _install directory into which it installed
  the binary release. You need to rename that directory as "llvm" and then
  create tarballs from the contents of that "llvm" directory.</p>
  <p>Finally, use rpm to make an rpm package based on the llvm.spec file. Don't
  forget to update the version number, documentation, etc. in the llvm.spec
  file.</p>
</div>

<!-- *********************************************************************** -->
<hr>
<address>
  <a href="http://jigsaw.w3.org/css-validator/check/referer"><img
  src="http://jigsaw.w3.org/css-validator/images/vcss" alt="Valid CSS!"></a>
  <a href="http://validator.w3.org/check/referer"><img
  src="http://www.w3.org/Icons/valid-html401" alt="Valid HTML 4.01!" /></a>

  <a href="mailto:rspencer@x10sys.com">Reid Spencer</a><br>
  <a href="http://llvm.cs.uiuc.edu">The LLVM Compiler Infrastructure</a>
  <br/>
  Last modified: $Date$
</address>
</body>
</html>
